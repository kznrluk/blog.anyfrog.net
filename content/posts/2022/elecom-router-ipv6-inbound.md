---
title: "エレコム製のルーターはIPoEだとIPv6のインバウンドはすべて破棄される"
date: 2022-10-07T10:00:00+09:00
draft: false
---

表題の通りなんですが...。

## tldr

エレコム製のルーターはIPoE接続だとIPv6のインバウンドパケットをすべて蹴る設定になっている。
IPv6のインバウンドに対して、ポート開放やNAPTを利用することはできない。IPv6な自宅サーバーは建てることができない。

NATループバックも不可能。どうしたものか。

## 環境
インターリンク ZOOT NATIVE + 固定IPサービス (transix + IPIP)

エレコム WRC-X6000XS-G - [https://www.amazon.co.jp/gp/product/B0B56K2L4T](https://www.amazon.co.jp/gp/product/B0B56K2L4T)

## 経緯

### WRC-X6000XS-G NATループバック非対応
我が家ではNASを利用しています。主にGoogleフォトの代替として使っていて、外部からアクセスしたいシーンがよくあるためWebインターフェースだけ外部にも公開する設定にしてあります。

このWebインターフェース、NURO光だったころは、DNSに `nas.anyfrog.net` のようなホスト名に自宅のIPアドレスを登録すると、LANの中からも外からも同じホスト名で接続することができました。ですが、WRC-X6000XS-GではNATループバックに対応しておらず、LANの中から `nas.anyfrog.net` にアクセスすることができません。

一般的に、これを解決するにはLAN内にDNSを建てるかhostsで管理する必要がありますが、どちらも結構面倒くさいので、今回はIPv6アドレスもDNSに登録することにしました。

2022年の現代であれば、身の回りの機器は大体IPv6アドレスが振られていますし、IPv6アドレスであればNATループバックの問題も解消されます。

### LAN内からアクセスできるがLAN外からアクセスできない
設定を一通り終えてみると、LAN内からはアクセスできるがLAN外からアクセスできないことに気が付きました。ブラウザでの挙動として、パケットの行き先がないというよりは強制的にコネクションが切断されているような気配がします。

DNSのレコードを確認したり、NASのファイアウォールを変更したりしてみましたがうまくいかず。 `traceroute` で調べてみると、transixから先、つまりルーターの手前でパケットが消失していることがわかりました。

ルーターの設定を見たり一通りネットを調べても、IPv6のインバウンドやフィルタに関する記述は見つからず。サポートに連絡をしてみます。

### そしてサポートへ
エレコムのチャットサポートに連絡します。待ち人数は0人で、比較的すぐつながりました。

「transix + IPIP環境で、IPv4は通るがIPv6の着信は通らない」という比較的珍しそうな問い合わせ内容でしたが、すぐ「IPoEでのIPv6のポート開放や着信はサポートされていません」と回答を得ることができました。

めでたし😇

## 感想

WRC-X6000XS-Gは基本機能しっかりしてて通常使う分にはかなりいいルーターなのですが、すこし難しいことをやろうとすると対応していない、設定項目がない、みたいな感じですこし残念な気分になります。LACPがないとか、NATループバックできないとかはいいんですが、さすがにIPv6のインバウンド全部落とすのは設定で解除できるようにしてくれよ～。

一般家庭では使いやすいと思うのですが、定価5万程度のルーターであればもう少し詳細に設定をさせてくれるとありがたいなと思います。エレコムの担当者さん、ファームウェアアップデートでの対応待ってます。対応したらご一報ください。記事書き直します。

以上です。